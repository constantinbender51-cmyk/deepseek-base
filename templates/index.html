<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek Base Generator</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; background-color: #f4f4f9; }
        .container { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        textarea { width: 100%; height: 150px; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; resize: vertical; }
        button { background-color: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #output { margin-top: 20px; white-space: pre-wrap; background: #eee; padding: 15px; border-radius: 4px; min-height: 50px; border: 1px solid #ddd; }
        .label { font-weight: bold; margin-bottom: 5px; display: block; }
        .error { color: #cc0000; }
    </style>
</head>
<body>

<div class="container">
    <h1>DeepSeek-67b (Base)</h1>
    <p>Enter a prompt below. Since this is a "Base" model (not an Instruct model), it works best at completing sentences, stories, or code snippets rather than answering questions.</p>
    
    <label class="label" for="prompt">Prompt:</label>
    <textarea id="prompt" placeholder="def fibonacci(n):"></textarea>
    
    <button id="generateBtn" onclick="generateText()">Generate</button>
    
    <div id="resultContainer" style="display:none;">
        <label class="label">Result:</label>
        <div id="output"></div>
    </div>
</div>

<script>
    async function generateText() {
        const prompt = document.getElementById('prompt').value;
        const btn = document.getElementById('generateBtn');
        const outputDiv = document.getElementById('output');
        const resultContainer = document.getElementById('resultContainer');

        if (!prompt) return alert("Please enter a prompt");

        // UI Loading State
        btn.disabled = true;
        btn.innerText = "Generating...";
        outputDiv.innerText = "";
        outputDiv.style.color = "black";
        resultContainer.style.display = 'block';

        try {
            const response = await fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });

            // 1. Get raw text first to check if it's JSON or HTML
            const text = await response.text();
            
            try {
                // 2. Try to parse as JSON
                const data = JSON.parse(text);
                
                if (response.ok) {
                    outputDiv.innerText = data.result || "(No output generated)";
                } else {
                    outputDiv.innerText = "Error: " + (data.error || "Unknown server error");
                    outputDiv.style.color = "red";
                }
            } catch (jsonError) {
                // 3. If parsing fails, it's likely an HTML error page from Railway/Flask
                console.error("Server returned non-JSON:", text);
                outputDiv.innerText = "Server Error (See console for full details):\n" + text.substring(0, 500) + "...";
                outputDiv.style.color = "red";
            }

        } catch (error) {
            outputDiv.innerText = "Network Error: " + error.message;
            outputDiv.style.color = "red";
        } finally {
            btn.disabled = false;
            btn.innerText = "Generate";
        }
    }
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek Base Generator</title>
    
    <!-- Markdown and Syntax Highlighting Support -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        :root { --bg: #1e1e2e; --surface: #313244; --text: #cdd6f4; --accent: #89b4fa; --border: #45475a; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 2rem; }
        
        .container { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 280px 1fr; gap: 20px; }
        
        /* Sidebar Styles */
        .sidebar { background: var(--surface); padding: 20px; border-radius: 8px; border: 1px solid var(--border); height: fit-content; }
        .control-group { margin-bottom: 1.5rem; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 0.5rem; color: #a6adc8; }
        select, input[type="range"] { width: 100%; padding: 8px; background: #181825; border: 1px solid var(--border); color: white; border-radius: 4px; box-sizing: border-box; }
        .val-display { float: right; font-family: monospace; color: var(--accent); }
        
        /* Editor Styles */
        .editor-col { display: flex; flex-direction: column; gap: 1rem; }
        textarea { 
            width: 100%; height: 160px; padding: 15px; 
            background: #181825; border: 1px solid var(--border); 
            color: var(--text); border-radius: 8px; 
            font-family: 'Courier New', monospace; font-size: 1rem;
            resize: vertical; box-sizing: border-box;
        }
        textarea:focus { outline: 2px solid var(--accent); border-color: transparent; }

        .btn-row { display: flex; gap: 10px; }
        button { 
            flex: 1; padding: 12px; border: none; border-radius: 6px; 
            font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 1rem; 
        }
        #genBtn { background-color: var(--accent); color: #1e1e2e; }
        #genBtn:hover { opacity: 0.9; }
        #stopBtn { background-color: #f38ba8; color: #1e1e2e; display: none; }

        /* Output Styles */
        #output { 
            background: #11111b; padding: 20px; border-radius: 8px; 
            border: 1px solid var(--border); min-height: 150px; 
            overflow-x: auto; line-height: 1.6;
        }
        /* Markdown Overrides */
        #output pre { background: #181825; padding: 1rem; border-radius: 6px; }
        #output code { font-family: 'Courier New', monospace; font-size: 0.9em; }
        #output p { margin-top: 0; }
        
        h1 { margin-top: 0; color: var(--accent); }
        .badge { font-size: 0.5em; vertical-align: middle; border: 1px solid var(--border); padding: 2px 6px; border-radius: 4px; color: #a6adc8; }
        
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <h1>DeepSeek <span class="badge">BASE</span></h1>
        <p style="font-size: 0.8rem; color: #a6adc8;">This is a base model. It completes patterns rather than answering questions.</p>
        
        <div class="control-group">
            <label>Presets</label>
            <select id="preset" onchange="applyPreset()">
                <option value="custom">Custom Prompt</option>
                <option value="python">Python Code</option>
                <option value="sql">SQL Query</option>
                <option value="story">Creative Story</option>
            </select>
        </div>

        <div class="control-group">
            <label>Temperature <span id="tempVal" class="val-display">0.7</span></label>
            <input type="range" id="temperature" min="0.1" max="2.0" step="0.1" value="0.7" oninput="updateVal('temperature', 'tempVal')">
        </div>

        <div class="control-group">
            <label>Max Tokens <span id="tokenVal" class="val-display">512</span></label>
            <input type="range" id="maxTokens" min="64" max="2048" step="64" value="512" oninput="updateVal('maxTokens', 'tokenVal')">
        </div>
    </div>

    <div class="editor-col">
        <textarea id="prompt" placeholder="Type a sentence or code snippet to complete..."></textarea>
        
        <div class="btn-row">
            <button id="genBtn" onclick="generate()">Generate</button>
            <button id="stopBtn" onclick="stopGen()">Stop</button>
        </div>

        <div id="output"></div>
    </div>
</div>

<script>
    let abortController = null;
    const outputDiv = document.getElementById('output');
    
    // Base models need specific prompts to work well
    const presets = {
        'python': { text: 'def binary_search(arr, target):\n    """\n    Iterative binary search implementation\n    """', temp: 0.2 },
        'sql': { text: '-- Table: users (id, name, email, signup_date)\n-- Query: Find users who signed up in the last 30 days\nSELECT', temp: 0.2 },
        'story': { text: 'The old lighthouse stood on the cliff, its light flickering against the storm. Inside, the keeper', temp: 0.85 }
    };

    function updateVal(inputId, displayId) {
        document.getElementById(displayId).innerText = document.getElementById(inputId).value;
    }

    function applyPreset() {
        const val = document.getElementById('preset').value;
        if(presets[val]) {
            document.getElementById('prompt').value = presets[val].text;
            document.getElementById('temperature').value = presets[val].temp;
            updateVal('temperature', 'tempVal');
        }
    }

    async function generate() {
        const prompt = document.getElementById('prompt').value;
        if (!prompt) return;

        // UI Updates
        document.getElementById('genBtn').style.display = 'none';
        document.getElementById('stopBtn').style.display = 'inline-block';
        outputDiv.innerHTML = '<span style="color: #6c7086;">Initializing stream...</span>';

        abortController = new AbortController();
        let fullText = "";

        try {
            const response = await fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: prompt,
                    temperature: document.getElementById('temperature').value,
                    max_tokens: document.getElementById('maxTokens').value
                }),
                signal: abortController.signal
            });

            // Handle Stream
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            outputDiv.innerHTML = ""; // Clear initializing message

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value, { stream: true });
                fullText += chunk;
                
                // Render Markdown
                outputDiv.innerHTML = marked.parse(fullText);
                
                // Apply Syntax Highlighting
                document.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
                
                // Scroll to bottom
                window.scrollTo(0, document.body.scrollHeight);
            }

        } catch (err) {
            if (err.name === 'AbortError') {
                outputDiv.innerHTML += "\n\n*[Stopped by user]*";
            } else {
                outputDiv.innerText += "\nError: " + err.message;
            }
        } finally {
            document.getElementById('genBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            abortController = null;
        }
    }

    function stopGen() {
        if (abortController) abortController.abort();
    }
</script>

</body>
</html>